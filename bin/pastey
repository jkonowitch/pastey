#!/usr/bin/env ruby

require 'yaml'

unless ARGV.any?
  puts "Please provide file path!"
  Kernel.exit
end

path_to_config = File.expand_path("~/.pastey_config")

unless File.exists?(path_to_config) && ( config = YAML.load(File.new(path_to_config)) ).has_key?("api_key")
  puts "Please place a .pastey_config file in your home directory with an API key."
end

require_relative '../lib/pastey'
require 'pathname'

API_KEY = config["api_key"]

pastebin = PasteBin.new(API_KEY)

file_path = ARGV.first

unless (file = Pathname.new(file_path)).absolute?
  file = Pathname.new( File.expand_path(file, Dir.pwd) )
end

paste_url = pastebin.send(File.open(file).read, file.basename.to_s, file.extname)

puts paste_url